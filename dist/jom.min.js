/*! jom 0.0.2 |                  @author Valtid Caushi                  @date 14-08-2015 */

(function(){var a=function(b){if(null===b||"object"!=typeof b)return b;var c;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof RegExp)return c=new RegExp(b);if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;d++)c[d]=a(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a(b[f]));return c}throw new Error("Unable to clone object!")},b=function(b){for(var c=[a(b[0])],d=c[0].key,e=c[0].object,f=1,g=b.length;g>f;f++)e=e[d],d=b[f].key,c.push({object:e,key:d});return c},c=function(a,b){var c=a.length-1,d=a[c].key;b[c].object[d]=a[c].object[d]},d={type:!0,not:!0,anyOf:!0,allOf:!0,oneOf:!0,$ref:!0,$schema:!0,id:!0,exclusiveMaximum:!0,exclusiveMininum:!0,properties:!0,patternProperties:!0,additionalProperties:!0,items:!0,additionalItems:!0,required:!0,"default":!0,title:!0,description:!0,definitions:!0,dependencies:!0},e={"null":function(a){return null===a},string:function(a){return"string"==typeof a},"boolean":function(a){return"boolean"==typeof a},number:function(a){return"number"==typeof a&&a===a},integer:function(a){return"number"==typeof a&&a%1===0},object:function(a){return a&&"object"==typeof a&&!Array.isArray(a)},array:function(a){return Array.isArray(a)},date:function(a){return a instanceof Date}},f={alpha:function(a){return/^[a-zA-Z]+$/.test(a)},alphanumeric:function(a){return/^[a-zA-Z0-9]+$/.test(a)},identifier:function(a){return/^[-_a-zA-Z0-9]+$/.test(a)},hexadecimal:function(a){return/^[a-fA-F0-9]+$/.test(a)},numeric:function(a){return/^[0-9]+$/.test(a)},"date-time":function(a){return!isNaN(Date.parse(a))&&-1===a.indexOf("/")},uppercase:function(a){return a===a.toUpperCase()},lowercase:function(a){return a===a.toLowerCase()},hostname:function(a){return a.length<256&&/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/.test(a)},uri:function(a){return/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/.test(a)},email:function(a){return/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/.test(a)},ipv4:function(a){if(/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/.test(a)){var b=a.split(".").sort();if(b[3]<=255)return!0}return!1},ipv6:function(a){return/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/.test(a)}},g={readOnly:function(a,b){return!1},minimum:function(a,b,c){return!(b>a||c.exclusiveMinimum&&b>=a)},maximum:function(a,b,c){return!(a>b||c.exclusiveMaximum&&a>=b)},multipleOf:function(a,b){return a/b%1===0||"number"!=typeof a},pattern:function(a,b){if("string"!=typeof a)return!0;var c,d;"string"==typeof b?c=b:(c=b[0],d=b[1]);var e=new RegExp(c,d);return e.test(a)},minLength:function(a,b){return a.length>=b||"string"!=typeof a},maxLength:function(a,b){return a.length<=b||"string"!=typeof a},minItems:function(a,b){return a.length>=b||!Array.isArray(a)},maxItems:function(a,b){return a.length<=b||!Array.isArray(a)},uniqueItems:function(a,b){for(var c={},d,e=0,f=a.length;f>e;e++){if(d=JSON.stringify(a[e]),c.hasOwnProperty(d))return!1;c[d]=!0}return!0},minProperties:function(a,b){if("object"!=typeof a)return!0;var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=1);return c>=b},maxProperties:function(a,b){if("object"!=typeof a)return!0;var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=1);return b>=c},constant:function(a,b){return JSON.stringify(a)==JSON.stringify(b)},"enum":function(a,b){var c,d,e;if("object"==typeof a){for(e=JSON.stringify(a),c=0,d=b.length;d>c;c++)if(e===JSON.stringify(b[c]))return!0}else for(c=0,d=b.length;d>c;c++)if(a===b[c])return!0;return!1}},h=function(a){return-1===a.indexOf("://")?a:a.split("#")[0]},i=function(a,b,c){var d,e,f,g;if(f=c.indexOf("#"),-1===f)return a.schema.hasOwnProperty(c)?[a.schema[c]]:null;if(f>0)if(g=c.substr(0,f),c=c.substr(f+1),a.schema.hasOwnProperty(g))b=[a.schema[g]];else{if(!b||b[0].id!==g)return null;b=[b[0]]}else{if(!b)return null;c=c.substr(1)}if(""===c)return[b[0]];if("/"===c.charAt(0)){c=c.substr(1),d=b[0],e=c.split("/");while(e.length>0){if(!d.hasOwnProperty(e[0]))return null;d=d[e[0]],b.push(d),e.shift()}return b}return null},j=function(a,b){var c,d,e=a.length-1,f,g,h=/^(\d+)/.exec(b);if(h){if(b=b.substr(h[0].length),f=parseInt(h[1],10),0>f||f>e)return;if(g=a[e-f],"#"===b)return g.key}else g=a[0];if(d=g.object[g.key],""===b)return d;if("/"===b.charAt(0)){b=b.substr(1),c=b.split("/");while(c.length>0){if(c[0]=c[0].replace(/~1/g,"/").replace(/~0/g,"~"),!d.hasOwnProperty(c[0]))return;d=d[c[0]],c.shift()}return d}},k=function(a,e,f,g){var h,l,m,n,o,p,q,r=!1,s={},t,u,v,w=e.length-1,x=e[w],y,z=f.length-1,A=f[z].object,B=f[z].key,C=A[B],D,E;if(x.hasOwnProperty("$ref"))return e=i(a,e,x.$ref),e?k(a,e,f,g):{$ref:x.$ref};if(x.hasOwnProperty("type"))if("string"==typeof x.type){if(g.useCoerce&&a.coerceType.hasOwnProperty(x.type)&&(C=A[B]=a.coerceType[x.type](C)),!a.fieldType[x.type](C))return{type:x.type}}else{for(r=!0,h=0,l=x.type.length;l>h&&r;h++)a.fieldType[x.type[h]](C)&&(r=!1);if(r)return{type:x.type}}if(x.hasOwnProperty("allOf"))for(h=0,l=x.allOf.length;l>h;h++)if(t=k(a,e.concat(x.allOf[h]),f,g))return t;if(g.useCoerce||g.useDefault||g.removeAdditional){if(x.hasOwnProperty("oneOf")){for(E=1/0,h=0,l=x.oneOf.length,m=0;l>h;h++)if(y=b(f),t=k(a,e.concat(x.oneOf[h]),y,g))D=t.schema?Object.keys(t.schema).length:1,E>D&&(E=D,s=t);else{if(m+=1,m>1)break;c(y,f)}if(m>1)return{oneOf:!0};if(1>m)return s;s={}}if(x.hasOwnProperty("anyOf")){for(s=null,E=1/0,h=0,l=x.anyOf.length;l>h;h++){if(y=b(f),t=k(a,e.concat(x.anyOf[h]),y,g),!t){c(y,f),s=null;break}D=t.schema?Object.keys(t.schema).length:1,E>D&&(E=D,s=t)}if(s)return s}if(x.hasOwnProperty("not")&&(y=b(f),t=k(a,e.concat(x.not),y,g),!t))return{not:!0}}else{if(x.hasOwnProperty("oneOf")){for(E=1/0,h=0,l=x.oneOf.length,m=0;l>h;h++)if(t=k(a,e.concat(x.oneOf[h]),f,g))D=t.schema?Object.keys(t.schema).length:1,E>D&&(E=D,s=t);else if(m+=1,m>1)break;if(m>1)return{oneOf:!0};if(1>m)return s;s={}}if(x.hasOwnProperty("anyOf")){for(s=null,E=1/0,h=0,l=x.anyOf.length;l>h;h++){if(t=k(a,e.concat(x.anyOf[h]),f,g),!t){s=null;break}D=t.schema?Object.keys(t.schema).length:1,E>D&&(E=D,s=t)}if(s)return s}if(x.hasOwnProperty("not")&&(t=k(a,e.concat(x.not),f,g),!t))return{not:!0}}if(x.hasOwnProperty("dependencies"))for(p in x.dependencies)if(x.dependencies.hasOwnProperty(p)&&C.hasOwnProperty(p))if(Array.isArray(x.dependencies[p])){for(h=0,l=x.dependencies[p].length;l>h;h++)if(!C.hasOwnProperty(x.dependencies[p][h]))return{dependencies:!0}}else if(t=k(a,e.concat(x.dependencies[p]),f,g))return t;if(Array.isArray(C)){if(x.hasOwnProperty("items"))if(Array.isArray(x.items)){for(h=0,l=x.items.length;l>h;h++)t=k(a,e.concat(x.items[h]),f.concat({object:C,key:h}),g),null!==t&&(s[h]=t,r=!0);if(C.length>l&&x.hasOwnProperty("additionalItems"))if("boolean"==typeof x.additionalItems){if(!x.additionalItems)return{additionalItems:!0}}else for(h=l,l=C.length;l>h;h++)t=k(a,e.concat(x.additionalItems),f.concat({object:C,key:h}),g),null!==t&&(s[h]=t,r=!0)}else for(h=0,l=C.length;l>h;h++)t=k(a,e.concat(x.items),f.concat({object:C,key:h}),g),null!==t&&(s[h]=t,r=!0);else if(x.hasOwnProperty("additionalItems")&&"boolean"!=typeof x.additionalItems)for(h=0,l=C.length;l>h;h++)t=k(a,e.concat(x.additionalItems),f.concat({object:C,key:h}),g),null!==t&&(s[h]=t,r=!0);if(r)return{schema:s}}else{u=[],s={};for(p in C)C.hasOwnProperty(p)&&u.push(p);if(g.checkRequired&&x.required)for(h=0,l=x.required.length;l>h;h++)C.hasOwnProperty(x.required[h])||(s[x.required[h]]={required:!0},r=!0);if(n=x.hasOwnProperty("properties"),o=x.hasOwnProperty("patternProperties"),n||o){h=u.length;while(h--){if(v=!1,n&&x.properties.hasOwnProperty(u[h])&&(v=!0,t=k(a,e.concat(x.properties[u[h]]),f.concat({object:C,key:u[h]}),g),null!==t&&(s[u[h]]=t,r=!0)),o)for(p in x.patternProperties)x.patternProperties.hasOwnProperty(p)&&u[h].match(p)&&(v=!0,t=k(a,e.concat(x.patternProperties[p]),f.concat({object:C,key:u[h]}),g),null!==t&&(s[u[h]]=t,r=!0));v&&u.splice(h,1)}}if(g.useDefault&&n&&!r)for(p in x.properties)x.properties.hasOwnProperty(p)&&!C.hasOwnProperty(p)&&x.properties[p].hasOwnProperty("default")&&(C[p]=x.properties[p]["default"]);if(g.removeAdditional&&n&&x.additionalProperties!==!0&&"object"!=typeof x.additionalProperties)for(h=0,l=u.length;l>h;h++)delete C[u[h]];else if(x.hasOwnProperty("additionalProperties"))if("boolean"==typeof x.additionalProperties){if(!x.additionalProperties)for(h=0,l=u.length;l>h;h++)s[u[h]]={additional:!0},r=!0}else for(h=0,l=u.length;l>h;h++)t=k(a,e.concat(x.additionalProperties),f.concat({object:C,key:u[h]}),g),null!==t&&(s[u[h]]=t,r=!0);if(r)return{schema:s}}for(q in x)x.hasOwnProperty(q)&&!d.hasOwnProperty(q)&&("format"===q?a.fieldFormat.hasOwnProperty(x[q])&&!a.fieldFormat[x[q]](C,x,f,g)&&(s[q]=!0,r=!0):a.fieldValidate.hasOwnProperty(q)&&!a.fieldValidate[q](C,x[q].hasOwnProperty("$data")?j(f,x[q].$data):x[q],x,f,g)&&(s[q]=!0,r=!0));return r?s:null},l={useDefault:!1,useCoerce:!1,checkRequired:!0,removeAdditional:!1};function m(){return this instanceof m?(this.coerceType={},this.fieldType=a(e),this.fieldValidate=a(g),this.fieldFormat=a(f),this.defaultOptions=a(l),void(this.schema={})):new m}m.prototype={validate:function(a,b,c){var d=[a],e=null,f=[{object:{__root__:b},key:"__root__"}];if("string"==typeof a&&(d=i(this,null,a),!d))throw new Error("jjv: could not find schema '"+a+"'.");if(c)for(var g in this.defaultOptions)this.defaultOptions.hasOwnProperty(g)&&!c.hasOwnProperty(g)&&(c[g]=this.defaultOptions[g]);else c=this.defaultOptions;return e=k(this,d,f,c),e?{validation:e.hasOwnProperty("schema")?e.schema:e}:null},resolveRef:function(a,b){return i(this,a,b)},addType:function(a,b){this.fieldType[a]=b},addTypeCoercion:function(a,b){this.coerceType[a]=b},addCheck:function(a,b){this.fieldValidate[a]=b},addFormat:function(a,b){this.fieldFormat[a]=b},addSchema:function(a,b){if(!b&&a&&(b=a,a=void 0),b.hasOwnProperty("id")&&"string"==typeof b.id&&b.id!==a){if("/"===b.id.charAt(0))throw new Error("jjv: schema id's starting with / are invalid.");this.schema[h(b.id)]=b}else if(!a)throw new Error("jjv: schema needs either a name or id attribute.");a&&(this.schema[h(a)]=b)}},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=m:"function"==typeof define&&define.amd?define(function(){return m}):this.jjv=m}).call(this);var Observe;Observe=function(){function a(b,c,d,e){var f,g,h,i,j,k,l;if(null==d&&(d=null),null==e&&(e=null),d=d||b,!b)throw new Error("Observe: Object missing.");if("function"!=typeof c)throw new Error("Observe: Callback should be a function.");if(l=d.constructor.name,"Array"===l)for(f=e,i=h=0,j=d.length;j>h;i=++h)g=d[i],"object"==typeof g&&(k=(f||"")+"["+i+"]",new a(b,c,g,k),k="");if("Object"===l){f=e;for(i in d)g=d[i],"object"==typeof g&&(f&&(k=f+"."+i),f||(k=""+i),new a(b,c,g,k),k="")}"Array"===d.constructor.name?(f=e,Array.observe(d,function(d){var e,g;return g={},e={},d.forEach(function(d,h){var i,j,l;return i=d.index>-1?d.index:d.name,k=(f||"")+"["+i+"]",l={path:k,value:d.object[d.index]||d.object[d.name]||d.object},j=d.addedCount>0||"add"===d.type,"object"==typeof l.value&&j&&(new a(b,c,l.value,l.path),k=""),g[h]=l,e[h]=d}),c(g,e)})):"Object"===d.constructor.name&&(f=e,Object.observe(d,function(d){var e,g;return g={},e={},d.forEach(function(d,h){var i,j;return f&&(k=f+"."+d.name),f||(k=""+d.name),j={path:k,value:d.object[d.name]},i="add"===d.type||d.addedCount>0,"object"==typeof j.value&&i&&(new a(b,c,j.value,j.path),k=""),g[h]=j,e[h]=d}),c(g,e)}))}return a}(),Function.prototype.getter=function(a,b){return Object.defineProperty(this.prototype,a,{get:b,configurable:!0,enumerable:!1})},Function.prototype.setter=function(a,b){return Object.defineProperty(this.prototype,a,{set:b,configurable:!0,enumerable:!1})},Function.prototype.property=function(a,b){return Object.defineProperty(this.prototype,a,b)},null==$.fn.findAll&&($.fn.findAll=function(a){return this.find(a).add(this.filter(a))}),null==$.fn.value&&($.fn.value=function(a,b){var c;return null==b&&(b=!1),console.info("go back to value change how it works"),a?($(this).data("value",arguments[0]),b===!0&&(c=$.trim(a),$(this).text(c)),$(this).trigger("jom.change"),$(this)):$(this).data("value")});var Asset,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Asset=function(){a.name=null,a.source="",a.origin="",a.content_type={},a.element={};function a(a){var b,c,d,e,f,g,h;if(b=$(a),this.rel=b.attr("rel"),void 0===this.rel)throw new Error("jom: rel=asset is required");if(this.name=b.attr("name")||null,this.source=b.attr("source"),this.asset=b.attr("asset"),this.original=a,this.clone=b.clone(),h=b.attr("type"),void 0===h)throw new Error("jom: asset type is required");switch(g=h.split(";"),e=$.trim(g[0]),d=$.trim(g[1])||null,this.content_type={full:h,part:e,type:e.split("/")[0],media:e.split("/")[1],params:d},b.get(0).asset=!0,this.element=this.create_element(),this.content_type.part){case"text/html":this.error("name"),this.error("source"),this.error("asset");break;case"text/json":this.error("name"),this.error("source"),this.error("asset");break;default:this.error("source")}if(c=["schema","collection","template","javascript","css","img","plain"],this.asset&&(f=this.asset,indexOf.call(c,f)>=0==!1))throw new Error("jom: asset attr '"+this.asset+"' is not valid")}return a.prototype.error=function(a){var b;if(b=["name","source","asset"],indexOf.call(b,a)>=0&&void 0===this[a])throw new Error("jom: "+a+" attr is required")},a.prototype.create_element=function(){var a;switch(this.content_type.part){case"text/html":a="<link    rel=import href='"+this.source+"' type='text/html' name='"+this.name+"' asset='"+this.asset+"' />";break;case"text/css":a="<link    href='"+this.source+"' rel='stylesheet' type='text/css' name='"+this.name+"' asset='"+this.asset+"' />";break;case"text/javascript":a="<script  src='"+this.source+"' type='text/javascript' async=true name='"+this.name+"' asset='"+this.asset+"' />";break;case"text/json":a="<script  source='"+this.source+"' type='"+this.content_type.part+"' async='true' name='"+this.name+"' asset='"+this.asset+"' />";break;case"text/plain":a="<script  type='"+this.content_type.part+"' async='true' name='"+this.name+"' asset='"+this.asset+"' />";break;default:throw a=null,"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("media: ",this.content_type.part),new Error("jom: asset media `"+this.content_type.full+"` type is not valid")}return a},a}();var Shadow;Shadow=function(){function a(){var a,b,c,d,e;this.root=(null!=(a=document.currentScript)?a.parentNode:void 0)||(null!=(b=arguments.callee)&&null!=(c=b.caller)&&null!=(d=c.caller)&&null!=(e=d.arguments[0])?e.target:void 0)||null,this.traverseAncestry(),this.root}return a.prototype.traverseAncestry=function(a){var b;return(null!=(b=this.root)?b.parentNode:void 0)||a?(this.root=this.root.parentNode||a,this.traverseAncestry(this.root.parentNode)):void 0},a.getter("body",function(){return $(this.root).children().filter("[body]").get(0)||null}),a.getter("host",function(){var a;return(null!=(a=this.root)?a.host:void 0)||null}),a}(),Object.defineProperty(window,"Root",{get:function(){return new Shadow}});var Collection;Collection=function(){var a;b.name="",b.data=[],b.schema={},b.errors=null,b.observing=!1,a=jjv();function b(a,b,c){if(null==b&&(b=[]),null==c&&(c={}),void 0===a||!a||"string"!=typeof a)throw new Error("jom: collection name is required");this.name=a,this.data=[],this.schema={},this.attach_schema(c),this.attach_data(b),this.errors=null,this.observing=!1}return b.prototype.generate_id=function(){return(new Date).getTime()},b.prototype.meta=function(){return{id:this.generate_id()}},b.prototype.attach_data=function(a){var b,c,d,e;if(null==a&&(a=[]),e=a.length||Object.keys(a).length)if(Array.isArray(a))for(b=0,d=a.length;d>b;b++)c=a[b],c.meta=this.meta(),Object.defineProperty(c,"meta",{enumerable:!1}),this.data.push(c);else a.meta=this.meta(),Object.defineProperty(a,"meta",{enumerable:!1}),this.data.push(a);return this.data},b.prototype.attach_schema=function(a){if(null==a&&(a={}),void 0===a)throw new Error("collection: schema is missing");return this.schema=a},b.prototype.errors_to_string=function(){return JSON.stringify(this.errors)},b.prototype.is_valid=function(){var b;if(a=jjv(),b=Object.keys(this.schema).length,0===b)return!0;if(void 0===this.schema.$schema)throw new Error("jom: $schema is missing");return a.addSchema(this.name,this.schema),this.errors=a.validate(this.name,this.data),this.errors?!1:!0},b.prototype.join=function(a,b){var c,d,e,f,g;return f=this.join,b=""+b,e=b[0],g="["===e?a+b:a+"."+b,arguments.length>2&&(c=Array.prototype.splice.call(arguments,2),d=[],d.push(g),d.push.apply(d,c),g=this.join.apply(this,d)),g},b.prototype.findByPath=function(a){var b,c,d,e,f,g,h;for(e=/(\[)(\d+)(\])/g,h=a.replace(e,".$2").replace(/^\.*/,""),g=h.split("."),f=this.data,b=0,d=g.length;d>b;b++){if(c=g[b],void 0===f)return f;f=f[c]}return f},b}();var Component;Component=function(){var a,b,c;a=!1,b=/\${([^\s{}]+)}/,c=/\${([^\s{}]+)}/g;function d(a){var b,c,d,e;if(void 0===a)throw new Error("jom: component is required");if(b=$(a),b.get(0).component=!0,e=b.attr("template"),c=b.attr("collections"),d=b.attr("path"),!e)throw new Error("jom: component template is required");if(!c)throw new Error("jom: component collections is required");this.skip=!1,this.attr={template:e,collections:c},c=c.split(/\s*,\s*/g),this.collections_list=c,this.element=b.get(0),this.element.createShadowRoot||(this.element=wrap(this.element)),this.hide(),this.ready=!1,this.template=null,this.collections=[],this.path=d||"[0]",this.data=[],this.create_shadow(),this.root=this.element.shadowRoot,this.handles=[],this.events=[],this.scripts=[],this.scripts.status="init",this.init={template:!1,collections:!1}}return d.prototype.hide=function(){var a;return a=$(this.root),a.find("")},d.prototype.show=function(){},d.prototype.enable=function(){return a=!1},d.prototype.disable=function(){return a=!0},d.prototype.destroy=function(){},d.prototype.create_shadow=function(){return this.element.createShadowRoot()},d.prototype.define_template=function(a){if(!a||a instanceof Template==!1)throw new Error("jom: template cant be added");return this.template=a},d.prototype.define_collection=function(a){if(!a||a instanceof Collection==!1)throw new Error("jom: collection cant be added");return this.collections.push(a),this.collections},d.prototype.watcher=function(a,b){var c,d,e;throw new Error("what watcher!!!")},d.prototype.handlebars=function(a,c){var d,e,f;return f=c.collections,d=$(a),e=d.findAll("*").not("script, style, link, [repeat]").filter(function(){return 0===$(this).parents("[repeat]").length}),e.each(function(a){return function(c,d){var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(t=$(d).text(),0===$(d).children().length&&b.test(t)===!0){if(o=t,j=t.match(b)[1],p=j.split(":"),g=p[0],n=p[1],g=f[g],void 0===g)throw new Error("component: `"+o+"` is wrong, start with collection.");if(m=g.findByPath($.trim(n)),void 0===m){if("production"!==jom.env)throw new Error("Data: not found for `"+o+"` key.");console.info(m),m=""}$(d).text(t.replace(b,m)),d.handle={type:"node",path:n,full:g.join(g.name,n)},a.handles.push(d)}for(q=d.attributes,j=i=0,k=q.length;k>i;j=++i){if(e=q[j],b.test(e.name)){t=e.name,o=t;try{j=t.match(b)[1]}catch(u){throw h=u,new Error("Component: wrong key on attr name "+t)}if(r=j.split(":"),g=r[0],n=r[1],g=f[g],void 0===g)throw new Error("component: `"+o+"` is wrong, start with collection.");m=g.findByPath($.trim(n)),void 0===m&&"production"===jom.env&&(m=""),l=t.replace(b,m),$(d).removeAttr(e.name).attr(l,e.value),d.handle={attr:e,type:"attr_name",path:n,full:g.join(g.name,n)},a.handles.push(d)}if(b.test(e.value)){t=e.value,o=t;try{j=t.match(b)[1]}catch(u){throw h=u,new Error("Component: wrong key on attr value "+t)}if(s=j.split(":"),g=s[0],n=s[1],void 0===g)throw new Error("component: `"+o+"` is wrong, start with collection.");g=f[g],m=g.findByPath($.trim(n)),void 0===m&&"production"===jom.env&&(m=""),e.value=t.replace(b,m),d.handle={attr:e,type:"attr_value",path:n,full:g.join(g.name,n)},a.handles.push(d)}}return d}}(this)),d},d.prototype.handle_template_scripts=function(a){var b,c;return b=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},c=$(a).add(a.children).find("script"),$(c).filter("[src]").each(function(a,b){return b.onload=function(){return b.has_loaded=!0}}),$(c).not("[src]").eq(0).each(function(a,c){var d,e,f;return d="",f=new RegExp("^"+b(d)),e=f.test(c.text),c.text="(function(){\nvar\nshadow      = jom.shadow,\nbody        = shadow.body,\nhost        = shadow.host,\nroot        = shadow.root,\ncomponent   = host.component,\ncollections = component.collections\n;\n\n"+c.text+"\n})()",c})},d.prototype.on=function(a,b,c){var d,e,f,g;for(g=a.split(" "),e=0,f=g.length;f>e;e++)a=g[e],d={type:a,path:b,callback:c},this.events.push(d);return this},d.prototype.trigger=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;for(null==b&&(b={}),m=a.split(" "),e=0,h=m.length;h>e;e++)for(a=m[e],k=this.events,f=0,i=k.length;i>f;f++)if(c=k[f],a===c.type)for(l=this.handles,g=0,j=l.length;j>g;g++)d=l[g],-1!==d.handle.path.indexOf(c.path)&&c.callback.call(d,c,b);return this},d.prototype.repeat=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(null==c&&(c=null),null===c&&(c=[]),d=$(a),k=d.attr("repeat"),o=k,void 0===k)throw new Error("component: `repeat` attr missing");try{k=k.match(b)[1]}catch(s){throw g=s,new Error("Component: Wrong key `"+k+"`")}if(q=$([]),p=k.split(":"),f=p[0],m=p[1],void 0===f)throw new Error("component: `"+o+"` is wrong, start with collection.");if(c=void 0!==m&&m.length?this.collections[f].findByPath(m):this.collections[f].data,void 0===c)throw new Error("component: data not found `"+m+"`");for(void 0===m&&(m=""),h=j=0,l=c.length;l>j;h=++j)i=c[h],e=d.clone(),e.attr("repeated",!0),e.attr("repeat",null),e.attr("repeat-index",h),n=this.collections[f].join(m,"["+h+"]"),n=f+":"+n,r=e[0].outerHTML.replace(/(\${)([^\s{}]+)(})/g,"$1"+n+".$2$3"),r=r.replace(/(\{repeat\.index})/g,h),r=r.replace(/(\{repeat\.length})/g,c.length),q=q.add(r);return q},d}();var Template;Template=function(){function a(a){var b,c,d,e,f,g,h;if(null==a&&(a=null),this.original=a,b=$(a),0===b.length)throw new Error("jom: template is required");if(this.ready=!1,this.name=b.attr("name"),void 0===this.name)throw new Error("jom: template name attr is required");if(h=b.get(0),this.element=document.importNode(h.content,!0),this.body=$(this.element).children("[body]"),b.get(0).template=!0,void 0===this.body||0===this.body.length)throw new Error("jom: template body attr is required");for(this.schemas=[],g=$.trim(b.attr("schemas")),g=g.split(","),d=c=0,e=g.length;e>c;d=++c)f=g[d],g[d]=$.trim(f);this.schemas_list=g,g=g.join(","),this.schemas_attr=g,this.schemas_ready=!1,this.cloned=null,this.show_loader(),this.load_schemas()}return a.prototype.load_schemas=function(){var a,b,c,d,e,f,g,h;if(this.schemas_ready===!0)return this.ready=!0;for(this.schemas_ready=!0,0===this.schemas_list.length&&(this.schemas_ready=!1),e=this.schemas_list,a=0,c=e.length;c>a;a++)h=e[a],null===jom.schemas.get(h)&&(this.schemas_ready=!1);if(this.schemas_ready===!0){for(f=this.schemas_list,g=[],b=0,d=f.length;d>b;b++)h=f[b],g.push(this.schemas.push(jom.schemas.get(h)));return g}},a.prototype.show_loader=function(){var a,b;return b=$('<div class="temporary_loader"><i class="icon-loader animate-spin">Loading...</i></div>'),a={position:"absolute",top:0,left:0,bottom:0,right:0,"text-align":"center",display:"block","background-color":"#fff"},b.css(a),b.children("i").css({position:"absolute",top:"50%"}),$(".temporary_loader",this.element).remove(),$(this.element).append(b)},a.prototype.hide_loader=function(a){return $(a).add(a.children).findAll(".temporary_loader").remove()},a.prototype.define_schema=function(a){if(!a||a instanceof Schema==!1)throw new Error("jom: template schemas attr is required");return this.schemas.push(a)},a}();var Schema;Schema=function(){function a(a,b,c){if(null==c&&(c=null),this.name=a,!this.name)throw new Error("Schema: name is not defined");this.description=c,this.tree=b}return a}();var JOM,jom,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};JOM=function(){var a;a={};function b(){var a;a=window.jom=this,$("html").append("<foot/>"),this.templates=[],this.collections=[],this.components=[],this.assets=[],this.schemas=[],this.collections.get=function(b){return a.get("collection",b)},this.templates.get=function(b){return a.get("template",b)},this.schemas.get=function(b){return a.get("schema",b)},this.components.get=function(b){return a.get("component",b)},this.assets.get=function(b){return a.get("asset",b)},this.tasks(),this.env="production",this.app={title:"JOM is Awesome"}}return b.prototype.tasks=function(){return setTimeout(function(a){return function(){return a.load_assets(),a.load_components(),a.load_templates(),a.load_collections(),a.load_schemas(),a.inject_assets(),a.assemble_components(),a.watch_collections(),a.tasks()}}(this),100)},b.prototype.get=function(a,b){var c,d,e,f,g,h,i;if(null==b&&(b=!1),c=["collection","template","asset","schema"],h=!a,indexOf.call(c,h)>=0)throw new Error("jom: cannot get anything naughty.");if(b===!1)return this[a+"s"];for(i=this[a+"s"],f=e=0,g=i.length;g>e;f=++e)if(d=i[f],b===d.name)return this[a+"s"][f];return null},b.prototype.inject_assets=function(){return $.each(this.assets,function(a,b){var c;return null!=b.queued!=!0?(b.queued=!0,c=$("html>foot"),"text/json"===b.content_type.part&&$.getJSON(b.source).done(function(a){return c.find("script[source='"+b.source+"']").get(0).data=a}).error(function(a){throw new Error("Faild: to load a json asset")}),c.append(b.element)):void 0})},b.prototype.load_assets=function(){return $('link[rel="asset"]').each(function(a){return function(b,c){var d;return d=$(a.assets).filter(function(){return a.source===$(c).attr("source")}),"jinit"in c==!1&&0===d.length?(c.jinit=!0,a.assets.push(new Asset(c))):void 0}}(this))},b.prototype.load_schemas=function(){return $("foot script[asset=schema]").each(function(a){return function(b,c){var d,e,f;return"jinit"in c==!1&&void 0!==c.data?(c.jinit=!0,f=c.data||{},d=$(c).attr("name"),e=new Schema(d,f),a.schemas.push(e)):void 0}}(this))},b.prototype.load_components=function(){return $("component").each(function(a){return function(b,c){var d;return"jinit"in c==!1?(c.jinit=!0,d=new Component(c),a.components.push(d),c.component=d):void 0}}(this))},b.prototype.load_templates=function(){return $("foot link[rel=import][asset=template]").filter(function(a,b){return null!==b["import"]}).each(function(a){return function(b,c){var d,e;return e=c["import"].querySelector("template"),e&&"jinit"in e==!1&&void 0!==c["import"]?(e.jinit=!0,d=$(e).attr("name"),a.templates.push(new Template(e))):void 0}}(this))},b.prototype.load_collections=function(){return $("foot script[type='text/json'][asset=collection]").each(function(a){return function(b,c){var d,e;return"jinit"in c==!1&&void 0!==c.data?(c.jinit=!0,e=$(c).attr("name"),d=c.data,a.collections.push(new Collection(e,d))):void 0}}(this))},b.prototype.assemble_components=function(){var a;return a=6e4,"production"!==jom.env&&(a=1e4),$.each(this.components,function(b){return function(c,d){var e,f,g,h,i,j,k,l,m;if(d.skip===!0)return!1;if(d.ready===!0)return d.skip=!0,d.template.hide_loader(d.root),!1;if("timer"in d==!1&&(d.timer=new Date),new Date-d.timer>a)throw new Error("jom: Component `"+d.name+"` timedout");if(m=jom.templates.get(d.attr.template),d.init.template===!1&&m&&(d.init.template=!0,m=new Template(m.original),m.show_loader(),d.define_template(m),d.handle_template_scripts(m.element),d.template.component=d,d.root.appendChild(m.element),m.element=d.root),m&&m.ready===!1&&d.template.load_schemas(),d.init.collections===!1)for(f=!0,0===d.collections_list.length&&(f=!1),k=d.collections_list,g=0,i=k.length;i>g;g++)e=k[g],null===jom.collections.get(e)&&(f=!1);if(d.init.collections===!1&&f===!0)for(d.init.collections=!0,l=d.collections_list,h=0,j=l.length;j>h;h++)e=l[h],d.define_collection(jom.collections.get(e));return d.init.template===!0&&d.init.collections===!0&&d.template.ready===!0&&b.scripts_loaded(d)===!0?(b.repeater(d),d.handlebars(d.root.children,d),b.image_source_change(d),d.show(),d.ready=!0,d.trigger("ready")):void 0}}(this))},b.prototype.scripts_loaded=function(a){var b,c;return b=!0,c=$("script[src]",a.root),$(c).each(function(a,c){return null!=c.has_loaded!=!0?b=!1:void 0}),b},b.prototype.image_source_change=function(a){return $("[body] img",a.root).not("[repeat] img").each(function(a,b){var c;return c=$(b),c.attr("src",c.attr("source"))})},b.prototype.repeater=function(a,b){return null==b&&(b=null),b=b||$(a.template.element.children).filter("[body]"),$("[repeat]",b).each(function(b,c){var d;return c=$(c),d=a.repeat(c),d.insertAfter(c),c.hide()})},b.prototype.watch_collections=function(){var a,b,c,d;c=this.collections,d=[];for(b in c)a=c[b],a.observing===!1?(a.observing=!0,d.push(new Observe(a.data,function(a){return function(c){var d,e;e=[];for(b in c)d=c[b],e.push($.each(a.components,function(b,c){return $(c.root).find("[repeated]").remove(),$(c.root).find("[repeat]").show(),a.repeater(c,c.root),c.handlebars(c.root,c),a.image_source_change(c),$(c.root.host).trigger("change",[d,c.data,c.collection]),$(c.root).find("[repeat]").hide(),c.trigger("change",d)}));return e}}(this)))):d.push(void 0);return d},b.prototype.resolve=function(a){var b,c,d,e,f,g;switch(c=location.href,d=c.replace(location.protocol+"//","").replace(location.host,""),g=d,b=a[0],f=a[1],e="",b){case"/":"/"!==f&&(e=a);break;default:e=g.replace(/([\/]?[^\/]+[\/]?)$/g,"/"+a)}return e},b.getter("shadow",function(){return new Shadow}),b}(),jom=JOM=new JOM;
//# sourceMappingURL=jom.min.js.map