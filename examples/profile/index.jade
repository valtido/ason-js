//- script(src="/core/Template.class.js")
script(src="/core/Prop.class.js")
script(src="/core/jsonpath.js")
script(src="/core/Component.class.js")

script.
  JOM = {
    "collection": {
      "user": [
        {
          "name": {"first": "Valtid", "last": "Caushi"},
          "location": "London",
          "dob": "31/06/1988",
          "image":"http://placehold.it/90x90"
        },
        {
          "name": {"first": "Thomas", "last": "McKiernan"},
          "location": "Paris",
          "dob": "31/06/1988",
          "image":"http://placehold.it/90x90"
        },
        {
          "name": {"first": "Mario", "last": "Contessa"},
          "location": "Rome",
          "dob": "31/06/1988",
          "image":"http://placehold.it/90x90"
        }
      ]
    }
  }

div.xx

template(ns="profile")
  style.
    @import url("/assets/-/fontello/css/fontello.css");
    :host {display: block; padding: 20px; background: #fff; min-height: 90px; margin-bottom: 10px;}
    header {font-size: 30px;margin-bottom: 20px;}
    .icon-location {font-size: 25px; color: #900;}
    img {float: right;}
    i { width: 40px; display: inline-block; color: #333; text-align: center;margin-right: 10px;}

  img(src="\#{image}")
  header 
    i.icon-user
    span \#{name.first} \#{name.last}
  div
    i.icon-calendar
    span \#{dob}
  div
    i.icon-location
    span \#{location}



component(ns="profile" collection="user[0]") asd
  //- component(ns="profile" collection="user[1]" class="different")
  //- component(ns="profile" collection="user[2]")


//- change this late on
//- The double escape experiment
script.
  $('body').get(0).times_escaped = 0;
  $('body')
  .on('dblescape', function(){
    $('component').toggle()
  })
  .on('keyup', function (event){
    if(event.which==27){
      that = this
      this.times_escaped++;
      setTimeout (function (){
        if (that.times_escaped >= 2){
          //pressed it twice at least
          clearTimeout(timer);
          that.times_escaped = 0;
          $(that).trigger('dblescape')
        }
      }, 50)
      var timer = setTimeout(function(){
        that.times_escaped = 0;
      },500)
      
      
    }
  })
